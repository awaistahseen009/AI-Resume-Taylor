{% extends "base.html" %}
{% block title %}Cover Letters{% endblock %}
{% block content %}
<div class="container mx-auto px-4 py-8">
  <div class="max-w-3xl mx-auto">
    <div class="flex items-center justify-between mb-6">
      <h1 class="text-3xl font-bold text-white">Cover Letters</h1>
      <div class="space-x-2">
        <a href="{{ url_for('resume.preview_resume', resume_id=resume.id) }}" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg">Back to Preview</a>
        <form method="post" action="{{ url_for('resume.cover_letters', resume_id=resume.id) }}" class="inline">
          <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">Generate (up to 3)</button>
        </form>
      </div>
    </div>

    <div class="glass-effect rounded-xl p-6">
      {% if cover_letters and cover_letters.versions %}
        <div class="space-y-6">
          <div class="mb-2 text-dark-text-secondary">
            <span class="mr-2">Job:</span>
            <span class="font-semibold">{{ cover_letters.job_title or '—' }}</span>
            <span class="mx-2">•</span>
            <span class="mr-2">Company:</span>
            <span class="font-semibold">{{ cover_letters.company or '—' }}</span>
          </div>
          {% for cl in cover_letters.versions %}
            <div class="bg-dark-card border border-gray-700 rounded-lg p-0 overflow-hidden">
              <details class="group">
                <summary class="list-none select-none cursor-pointer px-4 py-3 flex items-center justify-between hover:bg-gray-800">
                  <span class="text-lg font-semibold text-dark-text">{{ cl.title }}</span>
                  <div class="flex items-center gap-2">
                    <button type="button" class="bg-gray-700 hover:bg-gray-600 text-white text-xs px-3 py-1.5 rounded-md"
                            onclick="copyLetter('letter-{{ loop.index }}')">Copy</button>
                    <svg class="w-4 h-4 text-gray-300 transition-transform group-open:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                  </div>
                </summary>
                <div class="px-4 pb-4">
                  <pre id="letter-{{ loop.index }}" class="whitespace-pre-wrap text-dark-text-secondary">{{ cl.content }}</pre>
                </div>
              </details>
            </div>
          {% endfor %}
        </div>
        <script>
          async function copyLetter(id) {
            try {
              const text = document.getElementById(id)?.innerText || '';
              await navigator.clipboard.writeText(text);
              // Lightweight feedback
              const btn = event.currentTarget;
              const prev = btn.innerText;
              btn.innerText = 'Copied!';
              setTimeout(() => btn.innerText = prev, 1200);
            } catch (e) {
              alert('Could not copy to clipboard');
            }
          }
        </script>
      {% else %}
        <p class="text-dark-text-secondary">No cover letters yet. Click Generate to create up to 3 versions.</p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
